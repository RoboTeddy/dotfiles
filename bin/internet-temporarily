#!/bin/sh

minutes=$1

echo "Why do you need the ever-distracting internet?"
read why
echo "$(date) | $why | $minutes" >> ~/why-internet.log

if [[ "$why" = "test" || "$why" = "lala" || "$why" = "hmm" || $why = "hmmm" || $why = "lalala" ]]; then
  echo "That won't do it."
  exit
fi

# temporarily kill messaging apps so I don't get sidetracked
messengers_to_restore=()
for app in "Viber" "Adium" "Slack" "Messages" "Discord"; do
  if pgrep $app; then
    echo "Killing $app"
    killall "$app"
    messengers_to_restore+=("$app")
  fi
done


function finish () {
  echo "Finishing..."
  internet-off
  for app in "${messengers_to_restore[@]}"; do
    echo "Relaunching $app"
    # Viber is rude and refuses to start hidden, so we don't restore it
    if [ "$app" != "Viber" ]; then
      open --hide "/Applications/$app.app/"
    fi
  done
}

trap finish EXIT

echo "Switching internet on for $minutes minutes"
internet-on

sleep $(($minutes * 60))
